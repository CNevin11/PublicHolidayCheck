<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Public Holiday Decision Helper</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script crossorigin src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <meta name="description" content="Answer a few questions and get the exact action you must take during a public holiday week. Supports Taiwan & Ireland." />
  <style>html, body { height: 100%; }</style>
</head>
<body class="min-h-screen bg-gray-50">
  <div class="max-w-3xl mx-auto p-6">
    <header class="mb-6">
      <h1 class="text-2xl font-semibold">Public Holiday Decision Helper</h1>
    </header>

    <div id="app"></div>

    <footer class="mt-10 text-xs text-gray-500">
      <p>
        Assumptions: Volunteered work on a public holiday can be banked and used later in the same
        calendar year with manager confirmation. Replacement rules differ by country and are applied
        automatically based on your selection above.
      </p>
    </footer>
  </div>

<script type="text/babel">
const { useState, useMemo } = React;

const DAYS = [
  { key: "sun", label: "Sunday" },
  { key: "mon", label: "Monday" },
  { key: "tue", label: "Tuesday" },
  { key: "wed", label: "Wednesday" },
  { key: "thu", label: "Thursday" },
  { key: "fri", label: "Friday" },
  { key: "sat", label: "Saturday" },
];

const SHIFTS = {
  "Sun–Thurs": { work: ["sun","mon","tue","wed","thu"], off: ["fri","sat"] },
  "Mon–Fri":   { work: ["mon","tue","wed","thu","fri"], off: ["sat","sun"] },
  "Tues–Sat":  { work: ["tue","wed","thu","fri","sat"], off: ["sun","mon"] },
};

const LOCATIONS = ["Ireland", "Taiwan"];

function labelForDay(key) {
  return DAYS.find(d => d.key === key)?.label ?? key;
}

function parseDate(str) {
  // YYYY-MM-DD
  if (!/^\d{4}-\d{2}-\d{2}$/.test(str)) return null;
  const [y, m, d] = str.split("-").map(Number);
  const dt = new Date(Date.UTC(y, m - 1, d));
  if (dt.getUTCFullYear() !== y || dt.getUTCMonth() !== m - 1 || dt.getUTCDate() !== d) return null;
  return dt;
}

function sameWeek(d1, d2) {
  // Week = Sunday..Saturday containing d1 (Ireland rule)
  const start = new Date(d1);
  start.setUTCHours(0,0,0,0);
  const day = start.getUTCDay(); // 0 = Sunday
  start.setUTCDate(start.getUTCDate() - day);
  const end = new Date(start);
  end.setUTCDate(start.getUTCDate() + 6);
  return d2 >= start && d2 <= end;
}

function sameMonth(d1, d2) {
  return d1.getUTCFullYear() === d2.getUTCFullYear() &&
         d1.getUTCMonth() === d2.getUTCMonth();
}

function determineOutcome({ location, shiftKey, phDayKey, phDateStr, willWork, replacementDateStr }) {
  const errors = [];
  const notes = [];
  const actions = [];

  if (!location) errors.push("Select a location.");
  if (!shiftKey) errors.push("Select your shift pattern.");
  if (!phDayKey) errors.push("Select the day of the week for the public holiday.");

  const phDate = parseDate(phDateStr);
  if (!phDate) errors.push("Enter a valid public holiday date in YYYY-MM-DD format.");

  if (errors.length) {
    return { errors };
  }

  const shift = SHIFTS[shiftKey];
  const isWorkday = shift.work.includes(phDayKey);
  const isRestDay = !isWorkday;

  // Sanity check between selected day-of-week and actual date
  const actualDayKey = DAYS[phDate.getUTCDay()].key;
  if (actualDayKey !== phDayKey) {
    notes.push(
      `Warning: The date you entered (${phDateStr}) is a ${labelForDay(actualDayKey)}, ` +
      `but you selected ${labelForDay(phDayKey)}. Please double-check.`
    );
  }

  if (!isRestDay) {
    // Public holiday is on a normal working day
    if (willWork) {
      actions.push("Work the public holiday.");
      actions.push("Request to bank this public holiday for later use within the same calendar year (subject to approval).");
    } else {
      actions.push("Take the public holiday off as a non-working day.");
      notes.push("No replacement rest day is required because the public holiday is on a working day.");
    }
    return { errors: [], actions, notes, isWorkday, isRestDay };
  }

  // PH falls on a rest day -> replacement is required
  if (!replacementDateStr) {
    return {
      errors: [
        "Because the public holiday falls on your rest day, you must enter a replacement date in YYYY-MM-DD format."
      ]
    };
  }

  const repDate = parseDate(replacementDateStr);
  if (!repDate) {
    return { errors: ["Enter a valid replacement date in YYYY-MM-DD format."] };
  }

  // Location-specific rules
  if (location === "Ireland" && !sameWeek(phDate, repDate)) {
    return {
      errors: ["For Ireland, the replacement date must be within the same week (Sunday–Saturday) as the public holiday."]
    };
  }

  if (location === "Taiwan" && !sameMonth(phDate, repDate)) {
    return {
      errors: ["For Taiwan, the replacement date must be within the same calendar month as the public holiday."]
    };
  }

  // Replacement must be a working day
  const repDayKey = DAYS[repDate.getUTCDay()].key;
  if (!shift.work.includes(repDayKey)) {
    return {
      errors: [
        `Replacement date must be one of your normal working days (${shift.work.map(labelForDay).join(", ")}).`
      ]
    };
  }

  actions.push(
    "Request to take the chosen replacement date as a roster rest day in place of the public holiday (subject to approval)."
  );

  if (willWork) {
    actions.push("Work on the public holiday (even though it is your roster rest day).");
    actions.push("Request to bank the public holiday entitlement for later use within the same calendar year (subject to approval).");
  } else {
    notes.push("You are not working on the public holiday; you are just moving your rest day into the valid period.");
  }

  return { errors: [], actions, notes, isWorkday, isRestDay };
}

function Pill({ children }) {
  return (
    <span className="inline-flex items-center rounded-full border border-gray-300 px-2 py-0.5 text-xs text-gray-700">
      {children}
    </span>
  );
}

function App() {
  const [location, setLocation] = useState("");
  const [shiftKey, setShiftKey] = useState("");
  const [phDayKey, setPhDayKey] = useState("");
  const [phDateStr, setPhDateStr] = useState("");
  const [willWork, setWillWork] = useState(false);
  const [replacementDateStr, setReplacementDateStr] = useState("");
  const [copied, setCopied] = useState(false);

  const outcome = useMemo(
    () => determineOutcome({ location, shiftKey, phDayKey, phDateStr, willWork, replacementDateStr }),
    [location, shiftKey, phDayKey, phDateStr, willWork, replacementDateStr]
  );

  const { errors = [], actions = [], notes = [], isWorkday, isRestDay } = outcome || {};

  // Build email-style request text (Option C)
  const emailText = useMemo(() => {
    if (!outcome || errors.length) return "";

    const lines = [];
    const phDay = labelForDay(phDayKey) || "-";

    // Case: PH on rest day -> always a replacement request
    if (isRestDay) {
      lines.push("I am submitting a request for approval of a replacement rest day.");
      lines.push("");
      lines.push(`Public Holiday: ${phDateStr || "-"} (${phDay})`);
      lines.push("Reason: The public holiday falls on my rostered rest day.");
      lines.push(`Requested Replacement Rest Day: ${replacementDateStr || "-"} (pending approval).`);
      lines.push("");
      if (willWork) {
        lines.push(
          `I am also requesting approval to work the public holiday on ${phDateStr || "-"} ` +
          "and bank this entitlement for later use within the current calendar year."
        );
      }
      return lines.join("\n");
    }

    // Case: PH on workday and they choose to work & bank it
    if (isWorkday && willWork) {
      lines.push("I am submitting a request for approval to work on a public holiday and bank the entitlement.");
      lines.push("");
      lines.push(`Public Holiday: ${phDateStr || "-"} (${phDay})`);
      lines.push(
        "I am requesting approval to work this public holiday and bank the entitlement " +
        "for later use within the current calendar year."
      );
      return lines.join("\n");
    }

    // PH on workday, not working -> nothing to approve, no email needed
    lines.push("No approval request is required for this scenario. You are taking the public holiday as a normal non-working day.");
    return lines.join("\n");
  }, [outcome, errors.length, isWorkday, isRestDay, phDateStr, phDayKey, replacementDateStr, willWork]);

  const summaryText = useMemo(() => {
    if (!outcome || errors.length) return "";
    const parts = [];
    if (emailText) {
      parts.push(emailText);
      parts.push("");
      parts.push("----");
      parts.push("");
    }
    parts.push(`Location: ${location || "-"}`);
    parts.push(`Shift: ${shiftKey || "-"}`);
    parts.push(`Public Holiday: ${phDateStr || "-"} (${labelForDay(phDayKey) || "-"})`);
    parts.push(`Working on PH: ${willWork ? "Yes (requesting to bank)" : "No"}`);
    if (replacementDateStr) {
      parts.push(`Replacement Date: ${replacementDateStr}`);
    }
    parts.push("");
    parts.push("Actions:");
    actions.forEach((a, i) => parts.push(`${i + 1}. ${a}`));
    if (notes.length) {
      parts.push("");
      parts.push("Notes:");
      notes.forEach(n => parts.push(`- ${n}`));
    }
    return parts.join("\n");
  }, [outcome, errors.length, emailText, location, shiftKey, phDateStr, phDayKey, willWork, replacementDateStr, actions, notes]);

  async function copySummary() {
    if (!summaryText) return;
    try {
      await navigator.clipboard.writeText(summaryText);
      setCopied(true);
      setTimeout(() => setCopied(false), 1500);
    } catch (e) {
      console.error(e);
    }
  }

  return (
    <div className="space-y-6">
      <section className="grid gap-4 sm:grid-cols-2">
        <div className="rounded-2xl border bg-white p-4 shadow-sm">
          <h2 className="text-sm font-medium">0) Location</h2>
          <select
            className="mt-2 w-full rounded-md border-gray-300 text-sm"
            value={location}
            onChange={e => setLocation(e.target.value)}
          >
            <option value="" disabled>Select location…</option>
            {LOCATIONS.map(loc => (
              <option key={loc} value={loc}>{loc}</option>
            ))}
          </select>
        </div>

        <div className="rounded-2xl border bg-white p-4 shadow-sm">
          <h2 className="text-sm font-medium">1) Your shift</h2>
          <select
            className="mt-2 w-full rounded-md border-gray-300 text-sm"
            value={shiftKey}
            onChange={e => setShiftKey(e.target.value)}
          >
            <option value="" disabled>Select shift…</option>
            {Object.keys(SHIFTS).map(s => (
              <option key={s} value={s}>{s}</option>
            ))}
          </select>
          {shiftKey && (
            <p className="mt-2 text-xs text-gray-600">
              Work days: {SHIFTS[shiftKey].work.map(labelForDay).join(", ")} ·
              {" "}Off days: {SHIFTS[shiftKey].off.map(labelForDay).join(", ")}
            </p>
          )}
        </div>

        <div className="rounded-2xl border bg-white p-4 shadow-sm">
          <h2 className="text-sm font-medium">2) Public holiday day of week</h2>
          <select
            className="mt-2 w-full rounded-md border-gray-300 text-sm"
            value={phDayKey}
            onChange={e => setPhDayKey(e.target.value)}
          >
            <option value="" disabled>Select day…</option>
            {DAYS.map(d => (
              <option key={d.key} value={d.key}>{d.label}</option>
            ))}
          </select>
        </div>

        <div className="rounded-2xl border bg-white p-4 shadow-sm">
          <h2 className="text-sm font-medium">3) Public holiday date (YYYY-MM-DD)</h2>
          <input
            type="text"
            className="mt-2 w-full rounded-md border-gray-300 text-sm"
            placeholder="YYYY-MM-DD"
            value={phDateStr}
            onChange={e => setPhDateStr(e.target.value)}
          />
          <p className="mt-2 text-xs text-gray-600">
            Example: 2026-02-17
          </p>
        </div>

        <div className="rounded-2xl border bg-white p-4 shadow-sm">
          <h2 className="text-sm font-medium">4) Will you work on the public holiday?</h2>
          <div className="mt-2 flex items-center gap-4 text-sm">
            <label className="inline-flex items-center gap-2">
              <input
                type="radio"
                name="willWork"
                checked={!willWork}
                onChange={() => setWillWork(false)}
              />
              No
            </label>
            <label className="inline-flex items-center gap-2">
              <input
                type="radio"
                name="willWork"
                checked={willWork}
                onChange={() => setWillWork(true)}
              />
              Yes, work & bank it
            </label>
          </div>
        </div>

        <div className="rounded-2xl border bg-white p-4 shadow-sm">
          <h2 className="text-sm font-medium">
            5) Replacement date (only if PH falls on your roster rest day)
          </h2>
          <input
            type="text"
            className="mt-2 w-full rounded-md border-gray-300 text-sm"
            placeholder="YYYY-MM-DD"
            value={replacementDateStr}
            onChange={e => setReplacementDateStr(e.target.value)}
          />
          <p className="mt-2 text-xs text-gray-600">
            Ireland: must be in the same week (Sun–Sat) as the PH. Taiwan: must be in the same month.
          </p>
        </div>
      </section>

      <section className="rounded-2xl border bg-white p-5 shadow-sm">
        <div className="flex items-center justify-between gap-4">
          <h3 className="text-sm font-semibold">Result</h3>
          <div className="flex items-center gap-2">
            <Pill>{location || "No location"}</Pill>
            <Pill>{shiftKey || "No shift"}</Pill>
            <Pill>PH: {phDayKey ? labelForDay(phDayKey) : "—"}</Pill>
            <Pill>{willWork ? "Working & banking" : "Not working"}</Pill>
          </div>
        </div>

        {errors.length > 0 ? (
          <ul className="mt-3 list-disc pl-5 text-sm text-red-600">
            {errors.map((e, i) => (
              <li key={i}>{e}</li>
            ))}
          </ul>
        ) : (
          <div className="mt-3 space-y-3">
            {emailText && (
              <div className="rounded-lg bg-gray-50 p-3 text-xs text-gray-800 whitespace-pre-line">
                {emailText}
              </div>
            )}
            <ol className="list-decimal pl-5 text-sm">
              {actions.map((a, i) => (
                <li key={i} className="mb-1">{a}</li>
              ))}
            </ol>
            {notes.length > 0 && (
              <div className="rounded-lg bg-gray-50 p-3 text-xs text-gray-700">
                <p className="font-medium">Notes</p>
                <ul className="mt-1 list-disc pl-5">
                  {notes.map((n, i) => (
                    <li key={i}>{n}</li>
                  ))}
                </ul>
              </div>
            )}
            <div className="flex items-center gap-2">
              <button
                onClick={copySummary}
                className="rounded-lg border bg-black px-3 py-1.5 text-xs font-medium text-white hover:opacity-90"
              >
                Copy Summary
              </button>
              {copied && (
                <span className="text-xs text-green-700">Copied.</span>
              )}
            </div>
            <p className="mt-2 text-xs text-gray-600">
              Please copy and paste the email-style text above into your request to your Team Lead.
            </p>
          </div>
        )}
      </section>
    </div>
  );
}

ReactDOM.createRoot(document.getElementById("app")).render(<App />);
</script>
</body>
</html>
